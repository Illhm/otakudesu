<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <title>Player Video</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body {
      margin:0; padding:0; height:100%; width:100%;
      background:#000; display:flex; justify-content:center; align-items:center;
      color:#ddd; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,sans-serif;
    }
    #wrap { position:relative; width:100vw; height:100vh; }
    iframe, img {
      width:100%; height:100%; border:0; object-fit:cover; display:block;
      background:#000;
    }
    #errorImg { display:none; }
    #hint {
      position:absolute; left:12px; bottom:12px; font-size:14px; opacity:.9;
      background:rgba(0,0,0,.5); padding:6px 10px; border-radius:8px;
      backdrop-filter: blur(2px);
    }
  </style>
</head>
<body>
  <div id="wrap">
    <iframe id="myIframe" src="https://www.blogger.com/video.g?token=AD6v5dwGTlPF8EtThHfX1eMQBKqYaF-RCfo0BZYDugueOvUei5gjecBv1TxeEDl2BdOiYqmNmIgtp9qv0VSaJueDj9PbmF_aFh-rYGI32cYpNwRXHciXghkA0eZa1INvaE5_3Fn_x7I9" allowfullscreen></iframe>
    <img id="errorImg" src="404.jpg" alt="Video gagal dimuat">
    <div id="hint">Memuat video�</div>
  </div>

  <script>
    const iframe   = document.getElementById("myIframe");
    const errorImg = document.getElementById("errorImg");
    const hint     = document.getElementById("hint");

    const maxTries = 3;
    let tries = 0;
    let loadTimer = null;

    function invalidSrc(u) {
      if (!u) return true;
      const s = String(u).trim();
      return (s === "" || s.endsWith("token="));
    }

    function showError(msg = "Gagal memuat video.") {
      if (loadTimer) { clearTimeout(loadTimer); loadTimer = null; }
      iframe.style.display = "none";
      errorImg.style.display = "block";
      hint.style.display = "block";
      hint.textContent = msg;
    }

    function setIframe(url) {
      if (loadTimer) { clearTimeout(loadTimer); loadTimer = null; }
      iframe.style.display = "block";
      errorImg.style.display = "none";
      hint.style.display = "block";
      hint.textContent = "Memuat video�";
      iframe.src = url;

      // Timeout load 10s
      loadTimer = setTimeout(() => {
        console.warn("Timeout load iframe");
        retryFetch();
      }, 10000);
    }

    async function retryFetch() {
      if (tries >= maxTries) {
        showError(`Gagal memuat setelah ${maxTries} percobaan.`);
        return;
      }
      tries++;
      const waitMs = 1200 * tries; // backoff ringan
      hint.textContent = `Mencoba ulang (${tries}/${maxTries})�`;

      await new Promise(r => setTimeout(r, waitMs));
      try {
        const res = await fetch(`?mode=json&_=${Date.now()}`, { cache: "no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();

        if (data && data.video && !invalidSrc(data.video)) {
          setIframe(data.video);
        } else {
          retryFetch();
        }
      } catch (e) {
        console.error(e);
        retryFetch();
      }
    }

    // Event listeners
    iframe.addEventListener("load", () => {
      if (loadTimer) { clearTimeout(loadTimer); loadTimer = null; }
      const current = iframe.getAttribute("src");
      if (invalidSrc(current)) {
        retryFetch();
      } else {
        hint.textContent = "Berhasil memuat.";
        setTimeout(() => { hint.style.display = "none"; }, 1500);
      }
    });

    iframe.addEventListener("error", () => {
      retryFetch();
    });

    // Kickstart
    (function init() {
      const first = iframe.getAttribute("src");
      if (!first || invalidSrc(first)) {
        retryFetch();
      } else {
        // jaga-jaga kalau initial src tidak pernah selesai
        loadTimer = setTimeout(() => { retryFetch(); }, 10000);
      }
    })();
  </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"1bc2e88e88534aa386a4a00fda6a0b89","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>
</html>
